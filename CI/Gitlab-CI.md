# How Does Gitlab Runner Relate to GitlabCI?

- (Gitlab CI) The dashboard is part of Gitlab and can be controlled by:
  - doing a git push to your gitlab instance
  - starting, cancelling, or retrying a pipeline in the web interface
  - making API requests to the gitlab instance
- The dashboard is the command and control center. It doesn’t do the work; it just delegates and supervises a pool of runners. When the dashboard receives instructions to start a pipeline, it adds that pipeline to a queue, and then feeds work from the queue to available runners.

- Gitlab Runners - The runners are individual computers that are running the Gitlab Runner binary. Typically, runners register themselves with the dashboard using a secure token generated by the dashboard
- References:
  - http://bryce.fisher-fleig.org/blog/faster-ci-debugging-with-gitlabci/index.html

## Anatomy of a Gitlab CI

### Pipeline
  -  A pipeline is a collection of jobs split in different stages.
### Job
  - Every job shouldn’t have any dependency with any other job in the same stage, while they can expect results by jobs from a previous stage.
  - A job is a collection of instructions that a runner has to execute.

  - Job Usecases:
  > A job can be automatic, so it starts automatically when a commit is pushed, or manual. A manual job has to be triggered by someone manually. This can be useful, for example, to automate a deploy, but still to deploy only when someone manually approves it. There is a way to limit who can run a job, so only trustworthy people can deploy, to continue the example before.

  > A job can also build artifacts that users can download, like it creates an APK you can download and test on your device; in this way both designers and testers can download an application and test it without having to ask for help to developers.

  - References:
    - https://about.gitlab.com/2018/01/22/a-beginners-guide-to-continuous-integration/

## Sample .gitlab-ci.yml
```yaml
variables:
GIT_SSL_NO_VERIFY: "true"
# Disable SSL problem, as a workaround to the error in:
# fatal: unable to access 'https://gitlab-ci-token:xxxxxxxxxxxxxxxxxxxx@gitlab.arcanys.com:8000/e-learning/vincent-bacalso.git/': SSL certificate problem: unable to get local issuer certificate

image: node:latest


cache: # this part here is global and is applied to all stages
  untracked: true # in this example cache the git untracked files like /node_modules
  paths:
    - node_modules/

before_script:
  - cd ./project/to/build-or-test
  - apt-get update
  - apt-get install zip unzip nodejs
  - npm install --progress=false # or use "--no-progress"
  # this disables the progress bar during npm install

stages: # the stages in the pipeline
  - test
  - build

test:
  stage: test # <- the stage class defined in the stages above
  script:
    - npm run test:unit
    # - npm run test:e2e
  only:
    - master

build:
  stage: build
  script:
    - npm run build
  artifacts:
    paths:
      - dist
  only:
    - master # Indicate that this stage only run when the master branch is updated
```